<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>头部</title>
    <link rel="stylesheet" href="../../lib/element-ui/lib/theme-chalk/index.css">
    <script src="../../lib/jquery.min.js"></script>
    <script src="../../lib/vue.js"></script>
    <script src="../../lib/element-ui/lib/index.js"></script>
    <style>
        #header {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            margin-left: 15px;
        }

        .setting {
            display: flex;
            margin-right: 30px;
        }

        .setting p {
            height: 22px;
            line-height: 22px;
            font-size: 16px;
            color: #FFFFFF;
        }

        .icon_settings {
            padding-left: 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        .el-dropdown-menu__item--divided:before {
            height: 0!important;
        }
        .el-dropdown-menu__item--divided {
            margin-top: 0!important;
            border-top: 1px solid #ECECEC!important;
        }
        .el-dropdown-menu {
            padding: 0!important;
            border: 1px solid #E6E6E6!important;
        }
        .el-dropdown-menu__item {
            line-height: 44px!important;
            padding: 0 25px!important;
            ont-family: PingFangSC-Regular!important;
            color: #666666!important;
        }
        .el-dialog__header {
            padding: 0 30px!important;
            line-height: 35px!important;
            font-size: 16px!important;
            color: #FFFFFF!important;
            background: #4993E5!important;
        }
        .el-dialog__body {
            padding: 20px 30px 0px!important;
        }
        .el-dialog__title {
            line-height: 35px!important;
            font-size: 16px!important;
            color: #FFFFFF!important;
        }
        .el-dialog__headerbtn {
            height: 35px!important;
            top: 0!important;
        }
        .el-dialog__headerbtn i {
            padding-left: 0!important;
            color: white!important;
            font-size: 18px!important;
        }
        [class*=" el-icon-"], [class^=el-icon-] {
            font-weight: bold!important;
        }
        .el-dialog__body .el-button {
            padding: 12px 16px!important;
            color: #475669!important;
            margin-bottom: 22px;
            margin-top: 18px;
        }
        .el-dialog__body .el-button.el-button--primary {
            color: #fff!important;
            background-color: #4993E5!important;
            border-color: #4993E5!important;
            margin-left: 5px;
        }
        .el-dialog__body .el-input--prefix .el-input__inner, .el-dialog__body .el-select .el-input__inner {
            border-radius: 0;
            border: none;
            border-bottom: 1px solid #DAE4EA;
            padding-left: 43px;
            color: #333333;
            height: 24px;
            line-height: 24px;
        }
        .el-dialog__body .el-input--prefix .el-input__inner::-webkit-input-placeholder {
            font-family: PingFangSC-Regular;
            font-size: 14px;
            color: #BBBBBB;
            letter-spacing: 0;
        }
        .el-dialog__body .el-input--prefix .el-input__inner::-moz-placeholder {
            font-family: PingFangSC-Regular;
            font-size: 14px;
            color: #BBBBBB;
            letter-spacing: 0;
        }
        .el-dialog__body .el-form-item__content {
            text-align: right;
            line-height: 35px;
        }
        .el-dialog__body .el-input__prefix, .el-input__suffix {
            color: #B9C3CD;
        }
        .el-input__suffix {
            display: none;
        }
        .el-form-item__error {
            padding-left: 43px;
        }
        .el-dialog__body .el-input__icon {
            line-height: 32px;
        }
        .el-dialog__body .el-select {
            width: 100%;
        }
        .el-dialog__body .el-button.el-button--text.timerBtn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 0 8px!important;
            line-height: 22px!important;
            font-size: 12px!important;
            margin: 0!important;
        }
        .el-dialog__body .el-button.el-button--text.timerBtn.active {
            border: 1px solid #4993E5!important;
            color: #4993E5!important;
        }
        .el-dialog__body .el-button.el-button--text.is-disabled.timerBtn.active, .el-button.el-button--text.is-disabled.timerBtn {
            border: 1px solid #CCCCCC!important;
            color: #AAAAAA!important;
        }
        .el-dialog__body .el-input.is-disabled .el-input__inner {
            background-color: white;
        }
    </style>
</head>
<body>
<div id="header">
    <div class="logo">
        <p style="color: white;">这里是logo</p>
    </div>
    <div class="setting">
        <p style="margin-right: 10px;">欢迎您，151****5248!</p>
        <p>
            <el-dropdown trigger="click" @command="handleCommand">
                <span>
                    <i class="icon_settings el-icon-edit"></i>
                </span>
                <el-dropdown-menu slot="dropdown">
                    <el-dropdown-item command="persional">个人信息</el-dropdown-item>
                    <el-dropdown-item command="account" divided>账户信息</el-dropdown-item>
                    <el-dropdown-item command="password" divided>登录密码</el-dropdown-item>
                </el-dropdown-menu>
            </el-dropdown>
        </p>
        <p><i class="icon_settings  el-icon-edit"></i></p>
    </div>

    <el-dialog width="382px" title="个人信息" :visible.sync="dialogPersionVisible"
               :close-on-click-modal=false>
        <el-form :model="ruleForm2" status-icon :rules="rules2" ref="ruleForm2">
            <el-form-item prop="account">
                <el-input v-model="ruleForm2.account" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请输入用户名"></el-input>
            </el-form-item>
            <el-form-item prop="ID">
                <el-input v-model="ruleForm2.ID" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请输入身份证号"></el-input>
            </el-form-item>
            <el-form-item prop="tel">
                <el-input v-model="ruleForm2.tel" prefix-icon="el-icon-edit"
                          auto-complete="off" :disabled=modifyTel
                          placeholder="请输入手机号"></el-input>
                <el-button class="timerBtn" v-bind:class="{ active: isActive }"
                           @click="modifyTel=true"
                           :disabled=btnActive type="text">{{ btnText }}</el-button>
            </el-form-item>
            <el-form-item prop="code">
                <el-input v-model.number="ruleForm2.code"
                          prefix-icon="el-icon-edit" placeholder="请输入验证码"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button @click="dialogPersionVisible = false">取消</el-button>
                <el-button type="primary" @click="submitForm('ruleForm2')">确定</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>
    <el-dialog width="382px" title="账户信息" :visible.sync="dialogAccountVisible"
               :close-on-click-modal=false>
        <el-form :model="ruleForm3" status-icon :rules="rules3" ref="ruleForm3">
            <el-form-item prop="bank_card">
                <el-input v-model.number="ruleForm3.bank_card" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="绑定银行卡"></el-input>
            </el-form-item>
            <el-form-item prop="confirm_card">
                <el-input v-model.number="ruleForm3.confirm_card" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="确认银行卡"></el-input>
            </el-form-item>
            <el-form-item prop="bank_account">
                <i style="position: absolute; z-index: 1; color: #B9C3CD; left: 4px;" class="el-input__icon el-icon-edit"></i>
                <el-select v-model="ruleForm3.bank_account" placeholder="开户银行">
                    <el-option label="中国工商银行" value="中国工商银行"></el-option>
                    <el-option label="中国农业银行" value="中国农业银行"></el-option>
                    <el-option label="中国建设银行" value="中国建设银行"></el-option>
                    <el-option label="中国邮政银行" value="中国邮政银行"></el-option>
                    <el-option label="广发银行" value="广发银行"></el-option>
                    <el-option label="中信银行" value="中信银行"></el-option>
                    <el-option label="兴业银行" value="兴业银行"></el-option>
                    <el-option label="浦发银行" value="浦发银行"></el-option>
                    <el-option label="浙商银行" value="浙商银行"></el-option>
                    <el-option label="恒丰银行" value="恒丰银行"></el-option>
                    <el-option label="光大银行" value="光大银行"></el-option>
                    <el-option label="招商银行" value="招商银行"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item prop="bank_branch">
                <el-input v-model="ruleForm3.bank_branch" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请输入开户支行"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button @click="dialogAccountVisible = false">取消</el-button>
                <el-button type="primary" @click="submitForm('ruleForm3')">确定</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>
    <el-dialog width="382px" title="登录密码" :visible.sync="dialogPasswordVisible"
               :close-on-click-modal=false>
        <el-form :model="ruleForm1" status-icon :rules="rules1" ref="ruleForm1">
            <el-form-item prop="old_pass">
                <el-input type="password" v-model="ruleForm1.old_pass" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请输入原密码"></el-input>
            </el-form-item>
            <el-form-item prop="new_pass">
                <el-input type="password" v-model="ruleForm1.new_pass" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请输入新密码"></el-input>
            </el-form-item>
            <el-form-item prop="check_pass">
                <el-input type="password" v-model="ruleForm1.check_pass" prefix-icon="el-icon-edit"
                          auto-complete="off" placeholder="请确认新密码"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button @click="dialogPasswordVisible = false">取消</el-button>
                <el-button type="primary" @click="submitForm('ruleForm1')">确定</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>
</div>
<script type="text/javascript">
    $(function () {
        var header = new Vue({
            el: '#header',
            data () {
                var validateOldPass = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请输入旧密码'));
                    } else {
                        callback();
                    }
                };
                var validateNewPass1 = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请输入新密码'));
                    } else {
                        if (this.ruleForm1.check_pass !== '') {
                            this.$refs.ruleForm1.validateField('check_pass');
                        }
                        callback();
                    }
                };
                var validateNewPass2 = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请再次输入新密码'));
                    } else if (value !== this.ruleForm1.new_pass) {
                        callback(new Error('两次输入密码不一致!'));
                    } else {
                        callback();
                    }
                };
                var validateAccount = (rule, value, callback) => {
                    if (!value) {
                        return callback(new Error('用户名不能为空'));
                    } else {
                        callback();
                    }
                };
                var validateID = (rule, value, callback) => {
                    var IDreg = /^(([1][1-5])|([2][1-3])|([3][1-7])|([4][1-6])|([5][0-4])|([6][1-5])|([7][1])|([8][1-2]))\d{4}(([1][9]\d{2})|([2]\d{3}))(([0][1-9])|([1][0-2]))(([0][1-9])|([1-2][0-9])|([3][0-1]))\d{3}[0-9xX]$/;
                    if (!value) {
                        return callback(new Error('身份证号不能为空'));
                    } else {
                        if (!IDreg.test(value)) {
                            callback(new Error('请输入正确格式的身份证号'));
                        } else {
                            callback();
                        }
                    }
                };
                var validateTel = (rule, value, callback) => {
                    var telreg = /^1[3|4|5|7|8][0-9]{9}$/;
                    if (value === '') {
                        callback(new Error('请输入手机号码'));
                    } else {
                        if (!telreg.test(value)) {
                            callback(new Error('请输入正确格式的手机号码'));
                        } else {
                            callback();
                        }
                    }
                };
                var validateCode = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请输入验证码'));
                    } else if (!Number.isInteger(value)) {
                        callback(new Error('请输入数值型验证码!'));
                    } else {
                        if (value.toString().length !== 6) {
                            callback(new Error('请输入6位验证'));
                        } else {
                            callback();
                        }
                    }
                };
                var validateBank = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请输入银行卡号'));
                    } else {
                        if (!(/[0-9]{16,19}/g).test(value)) {
                            callback(new Error('请输入正确格式的银行卡号'));
                        } else {
                            if (this.ruleForm3.confirm_card !== '') {
                                this.$refs.ruleForm3.validateField('confirm_card');
                            }
                            callback();
                        }
                    }
                };
                var validateCheckBank = (rule, value, callback) => {
                    if (value === '') {
                        callback(new Error('请再次确认银行卡号'));
                    } else if (value !== this.ruleForm3.bank_card) {
                        callback(new Error('两次输入银行卡号不一致!'));
                    } else {
                        callback();
                    }
                };
                return {
                    btnText: '发送验证码',
                    count: 60,
                    timer: null,
                    modifyTel: false,
                    btnActive: true,
                    dialogPersionVisible: false,
                    dialogAccountVisible: false,
                    dialogPasswordVisible: false,
                    ruleForm1: {
                        old_pass: '',
                        new_pass: '',
                        check_pass: ''
                    },
                    ruleForm2: {
                        account: '',
                        ID: '',
                        tel: '',
                        code: ''
                    },
                    ruleForm3: {
                        bank_card: '',
                        confirm_card: '',
                        bank_account: '',
                        bank_branch: ''
                    },
                    rules1: {
                        old_pass: [
                            { validator: validateOldPass, trigger: 'blur' }
                        ],
                        new_pass: [
                            { validator: validateNewPass1, trigger: 'blur' }
                        ],
                        check_pass: [
                            { validator: validateNewPass2, trigger: 'blur' }
                        ]
                    },
                    rules2: {
                        account: [
                            { validator: validateAccount, trigger: 'blur' }
                        ],
                        ID: [
                            { validator: validateID, trigger: 'blur' }
                        ],
                        tel: [
                            { validator: validateTel, trigger: 'blur' }
                        ],
                        code: [
                            { validator: validateCode, trigger: 'blur' }
                        ]
                    },
                    rules3: {
                        bank_card: [
                            { validator: validateBank, trigger: 'blur' }
                        ],
                        confirm_card: [
                            { validator: validateCheckBank, trigger: 'blur' }
                        ],
                        bank_account: [
                            { required: true, message: '请选择开户银行', trigger: 'change' }
                        ],
                        bank_branch: [
                            { required: true, message: '请输入开户支行', trigger: 'blur' }
                        ]
                    }
                };
            },
            computed: {
                isActive: function () {
                    return /^1[3|4|5|7|8][0-9]{9}$/.test(this.ruleForm2.tel);
                }
            },
            methods: {
                handleCommand(command) {
                    if (command === 'persional') {
                        this.dialogPersionVisible = true;
                    } else if (command === 'account') {
                        this.dialogAccountVisible = true;
                    } else {
                        this.dialogPasswordVisible = true;
                    }
                },
                submitForm(formName) {
                    this.$refs[formName].validate((valid) => {
                        if (valid) {
                            if (formName === 'ruleForm2') {
                                this.dialogPersionVisible = false;
                            } else if (formName === 'ruleForm1') {
                                this.dialogPasswordVisible = false;
                            } else {
                                this.dialogAccountVisible = false;
                            }
                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                }
            },
            watch: {
                isActive: function (newVal, oldVal) {
                    this.btnActive = oldVal;
                },
                modifyTel: function (newActive, oldActive) {
                    if (this.modifyTel) {
                        this.btnActive = true;
                        this.btnText = `${this.count}后重发`;
                        var that = this;
                        this.timer = setInterval(function () {
                            if (that.count === 1) {
                                clearInterval(that.timer);
                                that.btnText = '发送验证码';
                                that.count = 60;
                                that.modifyTel = false;
                                that.btnActive = false;
                            } else {
                                that.count--;
                                that.btnText = `${that.count}后重发`;
                            }
                        }, 1000)
                    }
                }
            }
        });
    });
</script>
</body>
</html>