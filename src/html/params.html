<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>参数配置</title>
    <link rel="stylesheet" href="../../lib/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../css/home.css">
    <script src="../../lib/jquery.min.js"></script>
    <script src="../../lib/vue.js"></script>
    <script src="../../lib/element-ui/lib/index.js"></script>
</head>
<style>
    #params {
        width: 100%;
        background: white;
    }
    .entryBtn {
        padding: 25px 0 25px 45px;
    }
    .entryBtn .el-button.is-round {
        padding: 5px 17px;
        background: #4993E5;
    }
    .entyrTable {
        width: 100%;
        margin-left: 20px;
    }
</style>
<body>
    <div id='params'>
        <div class="entryBtn">
            <el-button @click="entryType" type="primary" round>录入</el-button>
        </div>
        <div class="entyrTable">
            <div style="width: calc(100% - 40px); padding-bottom: 20px;">
                <el-table :data="paramsData">
                    <el-table-column min-width="120px" prop="name" label="股票名称">
                        </el-table-column>
                    <el-table-column min-width="120px" prop=sell_percent label="买卖数量(%)">
                        <template slot-scope="scope">
                            <span>{{ scope.row.sell_percent * 100 }}%</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop=price_percent label="买卖单价(%)">
                        <template slot-scope="scope">
                            <span>{{ scope.row.price_percent * 100 }}%</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop=price label="参考单价(元)">
                    </el-table-column>
                    <el-table-column label="操作" header-align="center"
                                                align="center">
                        <template slot-scope="scope">
                            <el-button type="text" size="small" @click="modifyParams(scope.row)">修改</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <div class="pagination_box">
                    <el-pagination background layout="prev, pager, next, jumper"
                                    :page-size=pagesize :total=entry_num
                                    @current-change="currentPageChange">
                    </el-pagination>
                </div>
            </div>
        </div>
        <el-dialog width="382px" :title="dialogTitle" :visible.sync="entryDialogVisible"
               :close-on-click-modal=false>
            <el-form :model="ruleForm" status-icon :rules="rules" ref="ruleForm">
                <el-form-item prop="name">
                        <div class="icon_img">
                            <img v-if="name_error" src="../images/account_pre.png" alt="">
                            <img v-if="!name_error" src="../images/account_after.png" alt="">
                        </div>
                    <el-input v-model="ruleForm.name"
                            auto-complete="off" placeholder="股票名称" :disabled="dialogTitle==='修改'"></el-input>
                </el-form-item>
                <el-form-item prop="sell_percent">
                        <div class="icon_img">
                            <img v-if="stock_num_error" src="../images/stock_num_pre.png" alt="">
                            <img v-if="!stock_num_error" src="../images/stock_num_after.png" alt="">
                        </div>
                    <el-input v-model.number="ruleForm.sell_percent"
                            auto-complete="off" placeholder="买卖数量(%)"></el-input>
                </el-form-item>
                <el-form-item prop="price_percent">
                        <div class="icon_img">
                            <img v-if="sell_price_error" src="../images/price_pre.png" alt="">
                            <img v-if="!sell_price_error" src="../images/price_after.png" alt="">
                        </div>
                    <el-input v-model.number="ruleForm.price_percent"
                            auto-complete="off" placeholder='买卖单价(%)'></el-input>
                </el-form-item>
                <el-form-item prop="price">
                        <div class="icon_img">
                            <img v-if="price_error" src="../images/price_pre.png" alt="">
                            <img v-if="!price_error" src="../images/price_after.png" alt="">
                        </div>
                    <el-input v-model.number="ruleForm.price"
                            auto-complete="off" placeholder="参考单价(元)"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button @click="entryDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="submitForm('ruleForm')">确定</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>
    </div>
    <script>
        $(function () {
            var params = new Vue({
                el: '#params',
                data () {
                    var validateName = (rule, value, callback) => {
                        if (value === '') {
                            this.name_error = true;
                            callback(new Error('请输入股票名称'));
                        } else {
                            this.name_error = false;
                            callback();
                        }
                    };
                    var validateStock = (rule, value, callback) => {
                        if (value === '') {
                            this.stock_num_error = true;
                            callback(new Error('请输入买卖数量的百分比'));
                        } else if (!Number.isInteger(value)) {
                            this.stock_num_error = true;
                            callback(new Error('请输入数值型!'));
                        } else if (value <= 0 || value >= 100) {
                            this.stock_num_error = true;
                            return callback(new Error('请输入大于0且小于100的数值!'));
                        } else {
                            this.stock_num_error = false;
                            callback();
                        }
                    };
                    var validatePricePercent = (rule, value, callback) => {
                        if (value === '') {
                            this.sell_price_error = true;
                            callback(new Error('请输入买卖单价百分比'));
                        } else if (!Number.isInteger(value)) {
                            this.sell_price_error = true;
                            callback(new Error('请输入数值型!'));
                        } else if (value <= 0 || value >= 100) {
                            this.sell_price_error = true;
                            return callback(new Error('请输入大于0且小于100的数值!'));
                        } else {
                            this.sell_price_error = false;
                            callback();
                        }
                    };
                    var validatePrice = (rule, value, callback) => {
                        if (value === '') {
                            this.price_error = true;
                            callback(new Error('请输入参考单价'));
                        } else if (!Number.isInteger(value)) {
                            this.price_error = true;
                            callback(new Error('请输入数值型!'));
                        } else {
                            this.price_error = false;
                            callback();
                        }
                    };
                    return {
                        pagesize: 8,
                        entry_num: 12,
                        dialogTitle: '录入',
                        entryDialogVisible: false,
                        name_error: true,
                        stock_num_error: true,
                        sell_price_error: true,
                        price_error: true,
                        paramsData: [{
                            name: '中经汇金',
                            sell_percent: 0.05,
                            price_percent: 0.1,
                            price: 10
                        }],
                        ruleForm: {
                            name: '中经汇金',
                            sell_percent: '',
                            price_percent: '',
                            price: ''
                        },
                        rules: {
                            name: [
                             { validator: validateName, trigger: 'blur' }
                            ],
                            sell_percent: [
                                { validator: validateStock, trigger: 'blur' }
                            ],
                            price_percent: [
                                { validator: validatePricePercent, trigger: 'blur' }
                            ],
                            price: [
                                { validator: validatePrice, trigger: 'blur' }
                            ]
                        }
                    }
                },
                methods: {
                    entryType () {
                        this.dialogTitle = '录入';
                        this.entryDialogVisible = true;
                    },
                    modifyParams (data) {
                        this.dialogTitle = '修改';
                        this.entryDialogVisible = true;
                        console.log(data);
                    },
                    currentPageChange (num) {
                        console.log(num);
                    },
                    submitForm (formName) {
                        this.$refs[formName].validate((valid) => {
                            if (valid) {
                                console.log('修改成功');
                                this.entryDialogVisible = false;
                            } else {
                                console.log('error submit!!');
                                return false;
                            }
                        });
                    }
                }
            })
        })
    </script>
</body>
</html>